---
title: "Cleaning Data With R"
author: "Paul G. Smith"
date: "10/31/2019"
output: 
  github_document:
    toc: true
    html_preview: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Cleaning Data With R
## Overview

The purpose of this project is to highlight issues related to cleaning data, and demonstrating many common strategies and techniques using R programming to clean and prep the data for analysis.

## Exploring raw data

Essential R commands:

- class, dim, names, str, glimpse, summary
- head, tail, print
- hist, plot
- gather -> combines multiple columns into two rows with key and value (tidyr)
- spread -> moves key value columns to multiple columns with keys as column names (tidyr)
- separate - > splits a column by _ or whatever seperator you choose to multiple columns (tidyr)
- unite -> combines multiple columns to one column with _ as the seperator (tidyr)
- as.character
- as.numeric
- as.integer
- as.factor
- as.logical
- ymd - (lubridate)
- mdy - (lubridate)
- hms - (lubridate)
- ymd_hms - (lubridate)

### What messy data looks like
- X column is just the row number
- days are spread but should be part of the date field and have one row per date
- year and month and day should be one data column
- measures are melted but should be each in a column
- and so on…
```{r echo=TRUE, message=TRUE, warning=TRUE}

# load and prep sample tables
weather <- readRDS('data/weather.rds')

# first look at a messy data set
# look at the first 6 rows
head(weather)
# look at the last 6 rows
tail(weather)  
# look at a summary of the data
str(weather)
```


### What clean data looks like
- Each row is a daily record of the weather
- There is a lot cleaned up here
- We will clean this data set in the last section

```{r echo=TRUE, message=TRUE, warning=TRUE}

# load and prep sample table
weather_clean <- readRDS('data/weather_clean.rds')

# look at the first 6 rows
head(weather_clean)
# look at the last 6 rows
tail(weather_clean)  
# look at a summary of the data
str(weather_clean)

```

### Exploring raw data

Using class, dim, names, str, glimpse, and summary

### Looking at the data

```{r echo=TRUE, message=TRUE, warning=TRUE}
# load the data
bmi <- readRDS('data/bmi.rds')

# look at the classgli
class(bmi)

# get the dimensions
dim(bmi)

# view the column names
names(bmi)
```

### Understanding the structure of the data

```{r echo=TRUE, message=TRUE, warning=TRUE}
# Check the structure of bmi
str(bmi)

# Load dplyr
library(dplyr)


# Check the structure of bmi, the dplyr way
glimpse(bmi)

# View a summary of bmi
summary (bmi)

```

### Look at the data

```{r echo=TRUE, message=TRUE, warning=TRUE}

# View the first 6 rows
head(bmi)

# View the first 15 rows
head(bmi, 15)

# View the last 6 rows
tail(bmi, 6)

# View the last 10 rows
tail(bmi, 10)
```

### Visualizing the data

```{r echo=TRUE, message=TRUE, warning=TRUE}

# Histogram of BMIs from 2008
hist(bmi$Y2008)

# Scatter plot comparing BMIs from 1980 to those from 2008
plot(bmi$Y1980, bmi$Y2008)

```

## Tidying data

### Introduction to tidy data

- Hadley Wickham’s paper on this from 2014 is the best resource for understanding what is tidy data
- Essentially it mean one row per observation and one type of observation per table
  + Observations as rows
  + Variables as columns
  + One type of observational unit per table
- If you see values in the column names like months or years, or stock names, you have untidy data

### Introduction to tidyr

Could do a whole notebook on this package, it does a lot
Here we really just use:

- *gather* combines multiple columns into two rows with key and value
- *spread* moves key value columns to multiple columns with keys as column names
- *separate* splits a column by _ or whatever seperator you choose to multiple columns
- *unite* combines multiple columns to one column with _ as the seperator

### Gathering columns into key-value-pairs

```{r echo=TRUE, message=TRUE, warning=TRUE}

# load tidyr
library(tidyr)

# look at the first 6 rows
head(bmi)

# Apply gather() to bmi and save the result as bmi_long
bmi_long <- gather(bmi, year, bmi_val, -Country)

# View the first 20 rows of the result
head(bmi_long,20)

```

### Spreading key-value pairs

```{r echo=TRUE, message=TRUE, warning=TRUE, paged.print=FALSE}

# Apply spread() to bmi_long
bmi_wide <- spread(bmi_long, year, bmi_val)

# View the head of bmi_wide
head(bmi_wide)
```

### Separating columns

```{r echo=TRUE, message=TRUE, warning=TRUE}
# load the bmi_cc file
bmi_cc <- readRDS('data/bmi_cc.rds')

# view the head
head(bmi_cc)

# use separate to split Country_ISO
bmi_cc_clean <- separate(bmi_cc, col = Country_ISO, 
                         into = c("Country", "ISO"), sep = "/")

# view the result
head(bmi_cc_clean)
```


### Uniting columns

```{r echo=TRUE, message=TRUE, warning=TRUE}
# use unite to join the two fields with a "-"
bmi_cc <- unite(bmi_cc_clean, Country_ISO, Country, ISO, sep = "-")

# View the results
head(bmi_cc)
```

### Addressing common symptoms of messy data

- Column headers are values, not variable names
  + eye colors as column names with boolean values in rows
-Variable are stored in both rows and columns
  + pet counts stored as key value pair in two columns. n_dogs and n_cats should be seperate columns
- Multiple variables are stored in one column
sex_age column with M.34, F.55 as values
A single observational unit is stored in multiple tables
Multiple types of observational units are stored in the same table
This should be split into two tables with key like most sql beginner data sets of sales and sales persons

### Column headers are values, not variable names


## Preparing data for analysis

